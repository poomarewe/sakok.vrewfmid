local MiniLib = {}
MiniLib.__index = MiniLib

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")

-- Remove existing UI
local existing = PlayerGui:FindFirstChild("MiniLibUI")
if existing then
	existing:Destroy()
end

-- Shadow helper
local function createShadow(parent)
	local shadow = Instance.new("ImageLabel")
	shadow.Name = "Shadow"
	shadow.BackgroundTransparency = 1
	shadow.Size = UDim2.new(1, 60, 1, 60)
	shadow.Position = UDim2.new(0, -30, 0, -30)
	shadow.ZIndex = parent.ZIndex - 1
	shadow.Image = "rbxassetid://1316045217"
	shadow.ImageTransparency = 0.5
	shadow.ScaleType = Enum.ScaleType.Slice
	shadow.SliceCenter = Rect.new(10, 10, 118, 118)
	shadow.Parent = parent
end

-- Drag function
local function makeDraggable(frame, dragBar)
	local dragging, dragStart, startPos

	local function onInputBegan(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position

			local connection
			connection = input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
					connection:Disconnect()
				end
			end)
		end
	end

	local function onInputChanged(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end

	dragBar.InputBegan:Connect(onInputBegan)
	UserInputService.InputChanged:Connect(onInputChanged)
end

-- Create Window
function MiniLib:CreateWindow(title)
	local self = setmetatable({}, MiniLib)

	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "MiniLibUI"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	ScreenGui.Parent = PlayerGui

	local MainFrame = Instance.new("Frame")
	MainFrame.Size = UDim2.new(0, 250, 0, 300)
	MainFrame.Position = UDim2.new(0, 100, 0, 100)
	MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	MainFrame.BackgroundTransparency = 0.2
	MainFrame.BorderSizePixel = 0
	MainFrame.Name = "MainFrame"
	MainFrame.ZIndex = 10
	MainFrame.Parent = ScreenGui

	createShadow(MainFrame)

	local gradient = Instance.new("UIGradient")
	gradient.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 35)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 30))
	}
	gradient.Rotation = 90
	gradient.Parent = MainFrame

	local TopBar = Instance.new("Frame")
	TopBar.Size = UDim2.new(1, 0, 0, 30)
	TopBar.BackgroundColor3 = Color3.fromRGB(45, 45, 60)
	TopBar.BackgroundTransparency = 0.2
	TopBar.BorderSizePixel = 0
	TopBar.Parent = MainFrame

	local Title = Instance.new("TextLabel")
	Title.Text = title or "MiniLib"
	Title.Size = UDim2.new(1, -30, 1, 0)
	Title.Position = UDim2.new(0, 5, 0, 0)
	Title.BackgroundTransparency = 1
	Title.TextColor3 = Color3.fromRGB(255, 255, 255)
	Title.Font = Enum.Font.GothamBold
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.TextSize = 18
	Title.Parent = TopBar

	local Close = Instance.new("TextButton")
	Close.Size = UDim2.new(0, 25, 0, 25)
	Close.Position = UDim2.new(1, -28, 0, 2)
	Close.BackgroundColor3 = Color3.fromRGB(120, 30, 160)
	Close.BackgroundTransparency = 0.2
	Close.Text = "X"
	Close.TextColor3 = Color3.fromRGB(255, 255, 255)
	Close.Font = Enum.Font.GothamBold
	Close.TextSize = 16
	Close.Parent = TopBar

	local closeShadow = Instance.new("UICorner")
	closeShadow.CornerRadius = UDim.new(0, 4)
	closeShadow.Parent = Close

	Close.MouseButton1Click:Connect(function()
		ScreenGui:Destroy()
	end)

	local Content = Instance.new("Frame")
	Content.Size = UDim2.new(1, -10, 1, -40)
	Content.Position = UDim2.new(0, 5, 0, 35)
	Content.BackgroundTransparency = 1
	Content.Name = "Content"
	Content.Parent = MainFrame

	local Layout = Instance.new("UIListLayout")
	Layout.Padding = UDim.new(0, 6)
	Layout.SortOrder = Enum.SortOrder.LayoutOrder
	Layout.Parent = Content

	self.ScreenGui = ScreenGui
	self.MainFrame = MainFrame
	self.Content = Content

	makeDraggable(MainFrame, TopBar)

	return self
end

-- Create Button
function MiniLib:CreateButton(text, callback)
	local Button = Instance.new("TextButton")
	Button.Size = UDim2.new(1, 0, 0, 32)
	Button.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
	Button.BackgroundTransparency = 0.2
	Button.TextColor3 = Color3.fromRGB(200, 180, 255)
	Button.Font = Enum.Font.Gotham
	Button.TextSize = 16
	Button.Text = text or "Button"
	Button.ZIndex = 11
	Button.Parent = self.Content

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 4)
	corner.Parent = Button

	local gradient = Instance.new("UIGradient")
	gradient.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, Color3.fromRGB(80, 60, 100)),
		ColorSequenceKeypoint.new(1, Color3.fromRGB(40, 40, 50))
	}
	gradient.Rotation = 90
	gradient.Parent = Button

	Button.MouseButton1Click:Connect(function()
		if typeof(callback) == "function" then
			callback()
		end
	end)
end

return MiniLib
